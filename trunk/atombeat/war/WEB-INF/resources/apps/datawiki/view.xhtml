<!--
    Copyright (C) 2010 University of Oxford

    This program is free software; you can redistribute it and/or modify it under the terms of the
    GNU Lesser General Public License as published by the Free Software Foundation; either version
    2.1 of the License, or (at your option) any later version.

    This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
    without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.
    See the GNU Lesser General Public License for more details.

    The full text of the license is available at http://www.gnu.org/copyleft/lesser.html
-->
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:xforms="http://www.w3.org/2002/xforms"
      xmlns:xs="http://www.w3.org/2001/XMLSchema"
      xmlns:ev="http://www.w3.org/2001/xml-events"
      xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
      xmlns:fr="http://orbeon.org/oxf/xml/form-runner"
      xmlns:atom="http://www.w3.org/2005/Atom">
      
    <head>
        <title>AtomBeat DataWiki - <xforms:output ref="instance('ins-entry')/atom:title"/></title>
        
        <xforms:model id="mod-main">

			<xforms:submission 
				id="sub-get-entry"
				resource="{xxforms:get-request-parameter('entry')}"
				method="get"
				replace="instance"
				instance="ins-entry">
			</xforms:submission>        

			<xforms:send ev:event="xforms-model-construct-done" submission="sub-get-entry"/>
			
            <xforms:instance id="ins-entry">
            	<atom:entry/>
            </xforms:instance>
            
            <xforms:bind nodeset="instance('ins-entry')/atom:content/table/tbody/tr">
            
            	<xforms:bind nodeset="td">
    	       		<xforms:bind nodeset="for $p in (position()) return .[instance('ins-entry')/atom:content/table/thead/tr/th[$p]/datatype = 'integer']" type="xs:integer"/>
	           	</xforms:bind>
 
            </xforms:bind>

        </xforms:model>
        
        <link rel="stylesheet" type="text/css" href="/ops/yui/tabview/assets/skins/sam/tabview.css"></link>
        <style type="text/css">
.yui-skin-sam tr.yui-dt-selected td, .yui-skin-sam tr.yui-dt-selected td.yui-dt-asc, .yui-skin-sam tr.yui-dt-selected td.yui-dt-desc {
	background-color:inherit;
	color:inherit;
}        </style>

    </head>
    
    <body>
    
    	<xforms:group ref="instance('ins-entry')">
	
			<p><a href="./">DataWiki</a></p>
			
			<h1><xforms:output ref="atom:title"/></h1>  
			
			<p></p>  	
    	
    		<div class="yui-navset yui-navset-top">
    			<ul class="yui-nav">
    				<li class="selected">
    					<a href="view?entry={atom:link[@rel='edit']/@href}">
	    					<em>View</em>
    					</a>
    				</li>
    				<li>
    					<a href="edit?entry={atom:link[@rel='edit']/@href}">
	    					<em>Edit</em>
    					</a>
   					</li>
    				<li>
    					<a href="schema?entry={atom:link[@rel='edit']/@href}">
	    					<em>Schema</em>
    					</a>
   					</li>
    			</ul>
    			
    			<div class="yui-content">
    			
					<xforms:group ref="atom:content/table">
					
			   			<fr:datatable 
			   				paginated="true" 
			   				sortAndPaginationMode="internal" 
			   				rowsPerPage="10"
			   				maxNbPagesToDisplay="9">
			   			
			   				<thead>
			   					<tr>
			   						<xforms:repeat nodeset="thead/tr/th">
										<th fr:sortable="true" fr:resizeable="true">
											<xforms:output value="label"/>
										</th>	    						
			   						</xforms:repeat>
			   					</tr>
			   				</thead>
			   				
			   				<tbody>
			   					<xforms:repeat nodeset="tbody/tr">
			   						<tr>
			    						<xforms:repeat nodeset="td">
											<td>
												<xforms:output value="."/>
											</td>	    						
			    						</xforms:repeat>
			   						</tr>
			   					</xforms:repeat>
			   				</tbody>
			   				
			   			</fr:datatable>
		
					</xforms:group>

    			</div>
    			
   			</div>
    			
    	</xforms:group>
 			
    	
    </body>
</html>
