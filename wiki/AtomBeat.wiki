#summary AtomBeat - an Atom protocol implementation for eXist

<wiki:toc/>

= Introduction =

AtomBeat is an [http://www.atomenabled.org/developers/protocol/atom-protocol-spec.php Atom Protocol] implementation for [http://exist.sourceforge.net/ eXist] 1.4.

== Features ==

  * Standard Atom Protocol operations are supported: create, retrieve, update and delete Atom entries and media resources; retrieve feeds of Atom collection members.

  * Extensions to the Atom Protocol for creating Atom collections and for updating collection metadata.

  * Optional extensions for versioning of collection members: retrieve feeds of revision history for any given Atom entry; retrieve any previous revision of an Atom entry.

  * Optional security system for management of access control lists for Atom collections and collection members; specify fine-grained access control rules for users, groups and roles; can be integrated with external authentication and user role management systems, e.g., via Spring Security.

== eXist already has an Atom Protocol implementation, why do another? ==

There are a couple of reasons why we've rolled our own Atom Protocol implementation, rather than using the Atom servlet that comes bundled with eXist...

  * We wanted to experiment with new features, like versioning and access control, and we found it quicker to do that by starting from scratch and working entirely in XQuery, rather than working with the existing Java servlet code.

  * eXist has its own security system, which borrows from the Unix model of users and groups. This is fine for many use cases, but there are situations where this is not sufficient to express the desired security model. For example, if you want to have an Atom collection where readers can retrieve any entry, authors can create entries, update any entry they have created, and choose other authors to collaborate with, and editors can update any entry, you cannot implement that with the Unix model of one user (owner) and group per resource. AtomBeat has an experimental security system based on access control lists, which is capable of expressing a wider range of security models. However, there are pros and cons here, see the section on security below (TODO).

  * eXist can be configured to authenticate users via HTTP basic or digest authentication, and the user's credentials can be either stored in the eXist database or can be drawn from an LDAP repository. While this is fine for many situations, other scenarios require integration with single-sign-on authentication systems and a variety of user databases. Rather than try to implement any of this ourselves, we have designed AtomBeat to work with a wide range of authentication systems. For example, it is straightforward to use AtomBeat with Spring Security, which gives you access to implementations of a variety of authentication mechanisms including OpenID and CAS, and configurable integration with a variety of user databases.

  * At the time of writing, the eXist Atom servlet has a couple of inconsistencies in the way it handles URLs in HTTP headers and Atom links. For example, when POSTing a new Atom entry to a collection, the 201 response should include a "Location" header, whose value should be an absolute URL, but the value returned by eXist is relative to the Atom servlet path. The href attribute values set in edit links are relative to the member's collection, which isn't necessarily incorrect, but is inconvenient if you want to use Atom links to link entries in different collections, then write queries to do joins across those collections. And the href attribute value in the edit-media link is relative to the collection URL with a "/" appended. AtomBeat uses absolute URLs throughout HTTP headers and Atom links, which should make writing client code and server-side queries a bit more straightforward.

== Why "Atom Beat"? ==

No particular reason. Apparently, "Atom Beat" was the name given to the style of drumming that Pete Best brought back to Liverpool after the Beatles' stint in Hamburg. It's got nothing to do with the Atom Publishing Protocol, but I saw it on an old Beatles gig poster and it caught my eye.

= Atom Protocol Examples =

Below are extracts from an HTTP trace obtained from running the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/protocol/TestAclProtocol.java AtomBeat main protocol test case]...

== Create Collection ==

Create a collection with PUT...

{{{
PUT /atombeat/atombeat/content/0.8781156714199748 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.8781156714199748
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:53 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.8781156714199748</atom:id>
    <atom:updated>2010-03-25T12:50:53.795Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.8781156714199748"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.8781156714199748"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.8781156714199748" type="application/atom+xml"/>
</atom:feed>
}}}

Create a collection with multiple path segments in the collection URI...

{{{
PUT /atombeat/atombeat/content/0.7626395466905128/0.46687399845932753 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7626395466905128/0.46687399845932753
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:53 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7626395466905128/0.46687399845932753</atom:id>
    <atom:updated>2010-03-25T12:50:53.922Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7626395466905128/0.46687399845932753"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7626395466905128/0.46687399845932753"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.7626395466905128/0.46687399845932753" type="application/atom+xml"/>
</atom:feed>
}}}

Create a collection with POST...

{{{
POST /atombeat/atombeat/content/0.7469907786741518 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7469907786741518
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:53 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7469907786741518</atom:id>
    <atom:updated>2010-03-25T12:50:54.392Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7469907786741518"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7469907786741518"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.7469907786741518" type="application/atom+xml"/>
</atom:feed>
}}}

== Update Collection (Feed Metadata) ==

First create a collection...

{{{
PUT /atombeat/atombeat/content/0.8100057655715261 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.8100057655715261
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:53 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.8100057655715261</atom:id>
    <atom:updated>2010-03-25T12:50:54.079Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.8100057655715261"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.8100057655715261"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.8100057655715261" type="application/atom+xml"/>
</atom:feed>
}}}

...then update the feed metadata...

{{{
PUT /atombeat/atombeat/content/0.8100057655715261 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 114
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection - Updated</atom:title></atom:feed>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:53 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.8100057655715261</atom:id>
    <atom:updated>2010-03-25T12:50:54.265Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.8100057655715261"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.8100057655715261"/>
    <atom:title>Test Collection - Updated</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.8100057655715261" type="application/atom+xml"/>
</atom:feed>
}}}

== Create Member ==

{{{
POST /atombeat/atombeat/content/0.6419037294650971 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 149
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Member</atom:title><atom:summary>This is a summary.</atom:summary></atom:entry>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.6419037294650971/30bb4ec2-6063-4139-a909-04ad4b4b865a.atom
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:53 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.6419037294650971/30bb4ec2-6063-4139-a909-04ad4b4b865a.atom</atom:id>
    <atom:published>2010-03-25T12:50:54.711Z</atom:published>
    <atom:updated>2010-03-25T12:50:54.711Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.6419037294650971/30bb4ec2-6063-4139-a909-04ad4b4b865a.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.6419037294650971/30bb4ec2-6063-4139-a909-04ad4b4b865a.atom"/>
    <atom:title>Test Member</atom:title>
    <atom:summary>This is a summary.</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T12:50:54.711Z</atom:updated>
        <atom:summary>initial revision</atom:summary>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.6419037294650971/30bb4ec2-6063-4139-a909-04ad4b4b865a.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.6419037294650971" type="application/atom+xml"/>
</atom:entry>
}}}

== Update Member ==

{{{
PUT /atombeat/atombeat/content/0.10891012247077969/28575db0-68d1-42e1-979c-82c66f73710b.atom HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 168
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Member - Updated</atom:title><atom:summary>This is a summary, updated.</atom:summary></atom:entry>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:54 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.10891012247077969/28575db0-68d1-42e1-979c-82c66f73710b.atom</atom:id>
    <atom:published>2010-03-25T12:50:55.032Z</atom:published>
    <atom:updated>2010-03-25T12:50:55.205Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.10891012247077969/28575db0-68d1-42e1-979c-82c66f73710b.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.10891012247077969/28575db0-68d1-42e1-979c-82c66f73710b.atom"/>
    <atom:title>Test Member - Updated</atom:title>
    <atom:summary>This is a summary, updated.</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T12:50:55.205Z</atom:updated>
        <atom:summary/>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.10891012247077969/28575db0-68d1-42e1-979c-82c66f73710b.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.10891012247077969/28575db0-68d1-42e1-979c-82c66f73710b.atom" type="application/atom+xml"/>
</atom:entry>
}}}

== Create Media ==

Create media with standard POST request...

{{{
POST /atombeat/atombeat/content/0.6186523946007124 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 15
Content-Type: text/plain;charset=utf-8

This is a test.


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.atom
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:55 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.atom</atom:id>
    <atom:published>2010-03-25T12:50:56.222Z</atom:published>
    <atom:updated>2010-03-25T12:50:56.222Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.atom"/>
    <atom:link rel="edit-media" type="text/plain" href="http://localhost:8081/atombeat/atombeat/content/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.media"/>
    <atom:content src="http://localhost:8081/atombeat/atombeat/content/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.media" type="text/plain"/>
    <atom:title type="text">download-11e860e2-31af-406e-99e6-88b815aa2bcf.media</atom:title>
    <atom:summary type="text">media resource (text/plain)</atom:summary>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.atom" type="application/atom+xml"/>
    <atom:link rel="edit-media-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.6186523946007124/11e860e2-31af-406e-99e6-88b815aa2bcf.media" type="application/atom+xml"/>
</atom:entry>
}}}

Create media using a multipart/form-data request...

{{{
POST /atombeat/atombeat/content/0.20512900924180555 HTTP/1.1
Accept: application/atom+xml
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 7105
Content-Type: multipart/form-data; boundary=kXNK-7stkWHMC8f6xX7tlT2GNYAdvwQKdLY

--kXNK-7stkWHMC8f6xX7tlT2GNYAdvwQKdLY
Content-Disposition: form-data; name="media"; filename="spreadsheet1.xls"
Content-Type: application/vnd.ms-excel; charset=ISO-8859-1
Content-Transfer-Encoding: binary

[binary data]
--kXNK-7stkWHMC8f6xX7tlT2GNYAdvwQKdLY
Content-Disposition: form-data; name="summary"
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 8bit

this is a great spreadsheet
--kXNK-7stkWHMC8f6xX7tlT2GNYAdvwQKdLY--


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.atom
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:58 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.atom</atom:id>
    <atom:published>2010-03-25T12:50:58.79Z</atom:published>
    <atom:updated>2010-03-25T12:50:58.79Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.atom"/>
    <atom:link rel="edit-media" type="application/vnd.ms-excel" href="http://localhost:8081/atombeat/atombeat/content/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.media"/>
    <atom:content src="http://localhost:8081/atombeat/atombeat/content/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.media" type="application/vnd.ms-excel"/>
    <atom:title type="text">spreadsheet1.xls</atom:title>
    <atom:summary type="text">this is a great spreadsheet</atom:summary>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.atom" type="application/atom+xml"/>
    <atom:link rel="edit-media-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.20512900924180555/b45080c0-fef6-4522-b7a8-09fdad5bbe8e.media" type="application/atom+xml"/>
</atom:entry>
}}}

== Update Media ==

{{{
PUT /atombeat/atombeat/content/0.13068350262951034/5d300938-e060-4afb-9883-2ea2d39b7710.media HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 25
Content-Type: text/plain;charset=utf-8

This is a test - updated.


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Disposition: attachment; filename=download-5d300938-e060-4afb-9883-2ea2d39b7710.media
Content-Type: text/plain;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:57 GMT


This is a test - updated.
}}}

== List Collection ==

{{{
GET /atombeat/atombeat/content/0.07384375682232591 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:57 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.07384375682232591</atom:id>
    <atom:updated>2010-03-25T12:50:57.324Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.07384375682232591"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.07384375682232591"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.07384375682232591" type="application/atom+xml"/>
</atom:feed>
}}}

== Retrieve Member ==

{{{
GET /atombeat/atombeat/content/0.7042458626173562/72d2bfe7-3225-4dc1-80cd-751c4bbde024.atom HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:57 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7042458626173562/72d2bfe7-3225-4dc1-80cd-751c4bbde024.atom</atom:id>
    <atom:published>2010-03-25T12:50:57.781Z</atom:published>
    <atom:updated>2010-03-25T12:50:57.781Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7042458626173562/72d2bfe7-3225-4dc1-80cd-751c4bbde024.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7042458626173562/72d2bfe7-3225-4dc1-80cd-751c4bbde024.atom"/>
    <atom:title>Test Entry</atom:title>
    <atom:summary>this is a test</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T12:50:57.781Z</atom:updated>
        <atom:summary>initial revision</atom:summary>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.7042458626173562/72d2bfe7-3225-4dc1-80cd-751c4bbde024.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.7042458626173562/72d2bfe7-3225-4dc1-80cd-751c4bbde024.atom" type="application/atom+xml"/>
</atom:entry>
}}}

== Retrieve Media ==

{{{
GET /atombeat/atombeat/content/0.2829441296181656/95559ef5-5838-4d46-8aa9-30aa9029e747.media HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Disposition: attachment; filename=download-95559ef5-5838-4d46-8aa9-30aa9029e747.media
Content-Type: text/plain;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 12:50:58 GMT


This is a test.
}}}

== Delete Member ==

{{{
DELETE /atombeat/atombeat/content/0.2356199435327333/f276caed-d199-47e2-b4da-25745a3221d4.atom HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 204 No Content
}}}


== Delete Media ==

A media resource can be deleted *either* by deleting the associated media-link entry as above, or...

{{{
DELETE /atombeat/atombeat/content/0.7323249953709272/b35973ad-7923-4005-a105-11c9abf5e15e.media HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 204 No Content
}}}


= History Protocol Examples =

Below is an excerpt from an HTTP trace obtained from running the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/protocol/TestHistoryProtocol.javaAtomBeat history protocol test case]...

{{{
PUT /atombeat/atombeat/content/0.1995552997730068 HTTP/1.1
X-Atom-Enable-History: true
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.1995552997730068
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:24:09 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068</atom:id>
    <atom:updated>2010-03-25T13:24:09.471Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.1995552997730068" type="application/atom+xml"/>
</atom:feed>



POST /atombeat/atombeat/content/0.1995552997730068 HTTP/1.1
X-Atom-Revision-Comment: first draft
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 161
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Member</atom:title><atom:summary>This is a summary, first daft.</atom:summary></atom:entry>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:24:09 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</atom:id>
    <atom:published>2010-03-25T13:24:09.602Z</atom:published>
    <atom:updated>2010-03-25T13:24:09.602Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:title>Test Member</atom:title>
    <atom:summary>This is a summary, first daft.</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T13:24:09.602Z</atom:updated>
        <atom:summary>first draft</atom:summary>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.1995552997730068" type="application/atom+xml"/>
</atom:entry>



PUT /atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom HTTP/1.1
X-Atom-Revision-Comment: second draft
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 168
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Member - Updated</atom:title><atom:summary>This is a summary, updated.</atom:summary></atom:entry>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:24:09 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</atom:id>
    <atom:published>2010-03-25T13:24:09.602Z</atom:published>
    <atom:updated>2010-03-25T13:24:09.781Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:title>Test Member - Updated</atom:title>
    <atom:summary>This is a summary, updated.</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T13:24:09.781Z</atom:updated>
        <atom:summary>second draft</atom:summary>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom" type="application/atom+xml"/>
</atom:entry>



PUT /atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom HTTP/1.1
X-Atom-Revision-Comment: third draft
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 188
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Member - Updated Again</atom:title><atom:summary>This is a summary, updated (third draft).</atom:summary></atom:entry>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:24:09 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</atom:id>
    <atom:published>2010-03-25T13:24:09.602Z</atom:published>
    <atom:updated>2010-03-25T13:24:09.915Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:title>Test Member - Updated Again</atom:title>
    <atom:summary>This is a summary, updated (third draft).</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T13:24:09.915Z</atom:updated>
        <atom:summary>third draft</atom:summary>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom" type="application/atom+xml"/>
</atom:entry>



GET /atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:24:09 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:title>History</atom:title>
    <v:history xmlns:v="http://exist-db.org/versioning">
        <v:document>/db/atom/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</v:document>
        <v:revisions>
            <v:revision rev="19">
                <v:date>2010-03-25T13:24:09.803Z</v:date>
                <v:user>admin</v:user>
            </v:revision>
            <v:revision rev="20">
                <v:date>2010-03-25T13:24:09.934Z</v:date>
                <v:user>admin</v:user>
            </v:revision>
        </v:revisions>
    </v:history>
    <v:version xmlns:v="http://exist-db.org/versioning">
        <v:properties>
            <v:document>0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</v:document>
            <v:user>admin</v:user>
            <v:date>2010-03-25T13:24:09.803Z</v:date>
            <v:revision>19</v:revision>
        </v:properties>
        <v:diff>
            <v:delete ref="1.3.1"/>
            <v:delete ref="1.6.1"/>
            <v:delete ref="1.7.1"/>
            <v:delete ref="1.8.2.1"/>
            <v:delete ref="1.8.3.1"/>
            <v:insert ref="1.3.1">2010-03-25T13:24:09.781Z</v:insert>
            <v:insert ref="1.6.1">Test Member - Updated</v:insert>
            <v:insert ref="1.7.1">This is a summary, updated.</v:insert>
            <v:insert ref="1.8.2.1">2010-03-25T13:24:09.781Z</v:insert>
            <v:insert ref="1.8.3.1">second draft</v:insert>
        </v:diff>
    </v:version>
    <v:version xmlns:v="http://exist-db.org/versioning">
        <v:properties>
            <v:document>0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</v:document>
            <v:user>admin</v:user>
            <v:date>2010-03-25T13:24:09.934Z</v:date>
            <v:revision>20</v:revision>
        </v:properties>
        <v:diff>
            <v:delete ref="1.3.1"/>
            <v:delete ref="1.6.1"/>
            <v:delete ref="1.7.1"/>
            <v:delete ref="1.8.2.1"/>
            <v:delete ref="1.8.3.1"/>
            <v:insert ref="1.3.1">2010-03-25T13:24:09.915Z</v:insert>
            <v:insert ref="1.6.1">Test Member - Updated Again</v:insert>
            <v:insert ref="1.7.1">This is a summary, updated (third draft).</v:insert>
            <v:insert ref="1.8.2.1">2010-03-25T13:24:09.915Z</v:insert>
            <v:insert ref="1.8.3.1">third draft</v:insert>
        </v:diff>
    </v:version>
    <atom:entry>
        <ar:revision xmlns:ar="http://purl.org/atompub/revision/1.0" number="1" when="2010-03-25T13:24:09.602Z" initial="yes"/>
        <atom:link rel="current-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:link rel="initial-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=1"/>
        <atom:link rel="this-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=1"/>
        <atom:link rel="next-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=2"/>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</atom:id>
        <atom:published>2010-03-25T13:24:09.602Z</atom:published>
        <atom:updated>2010-03-25T13:24:09.602Z</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:title>Test Member</atom:title>
        <atom:summary>This is a summary, first daft.</atom:summary>
        <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
            <atom:author>
                <atom:name>adam</atom:name>
            </atom:author>
            <atom:updated>2010-03-25T13:24:09.602Z</atom:updated>
            <atom:summary>first draft</atom:summary>
        </ar:comment>
    </atom:entry>
    <atom:entry>
        <ar:revision xmlns:ar="http://purl.org/atompub/revision/1.0" number="2" when="2010-03-25T13:24:09.781Z" initial="no"/>
        <atom:link rel="current-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:link rel="initial-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=1"/>
        <atom:link rel="this-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=2"/>
        <atom:link rel="next-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=3"/>
        <atom:link rel="previous-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=1"/>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</atom:id>
        <atom:published>2010-03-25T13:24:09.602Z</atom:published>
        <atom:updated>2010-03-25T13:24:09.781Z</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:title>Test Member - Updated</atom:title>
        <atom:summary>This is a summary, updated.</atom:summary>
        <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
            <atom:author>
                <atom:name>adam</atom:name>
            </atom:author>
            <atom:updated>2010-03-25T13:24:09.781Z</atom:updated>
            <atom:summary>second draft</atom:summary>
        </ar:comment>
    </atom:entry>
    <atom:entry>
        <ar:revision xmlns:ar="http://purl.org/atompub/revision/1.0" number="3" when="2010-03-25T13:24:09.915Z" initial="no"/>
        <atom:link rel="current-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:link rel="initial-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=1"/>
        <atom:link rel="this-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=3"/>
        <atom:link rel="previous-revision" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/history/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom?revision=2"/>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom</atom:id>
        <atom:published>2010-03-25T13:24:09.602Z</atom:published>
        <atom:updated>2010-03-25T13:24:09.915Z</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.1995552997730068/0c9ba353-f7ce-4601-a23f-e74ce17f4a87.atom"/>
        <atom:title>Test Member - Updated Again</atom

:title>
        <atom:summary>This is a summary, updated (third draft).</atom:summary>
        <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
            <atom:author>
                <atom:name>adam</atom:name>
            </atom:author>
            <atom:updated>2010-03-25T13:24:09.915Z</atom:updated>
            <atom:summary>third draft</atom:summary>
        </ar:comment>
    </atom:entry>
</atom:feed>
}}}

== Security (ACL) Plugin and Protocol Examples ==

Below are excerpts from the HTTP trace from running the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/protocol/TestAclProtocol.java AtomBeat ACL protocol test] against the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/war/atombeat/config/shared.xqm example default ACL configuration]...

Retrieve global ACL...

{{{
GET /atombeat/atombeat/acl/ HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:09 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:content type="application/vnd.atombeat+xml">
        <acl>
            <rules>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>create-collection</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>update-collection</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>list-collection</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>create-member</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>retrieve-member</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>update-member</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>delete-member</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>create-media</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>retrieve-media</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>update-media</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>delete-media</operation>
                </allow>
                <allow>
                    <role>ROLE_ADMINISTRATOR</role>
                    <operation>update-acl</operation>
                </allow><!-- you could also use a wildcard --><!--
            <allow>
                <role>ROLE_ADMINISTRATOR</role>
                <operation>*</operation>
            </allow>
            -->
            </rules>
        </acl>
    </atom:content>
</atom:entry>
}}}

List collection then retrieve collection ACL...

{{{
GET /atombeat/atombeat/content/0.7944490448575703 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:09 GMT


<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7944490448575703</atom:id>
    <atom:updated>2010-03-25T13:34:09.607Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7944490448575703"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7944490448575703"/>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.7944490448575703" type="application/atom+xml"/>
</atom:feed>



GET /atombeat/atombeat/acl/0.7944490448575703 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:09 GMT

ca5
<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:content type="application/vnd.atombeat+xml">
        <acl>
            <rules><!--  
            Authors can create entries and media, and can list the collection,
            but can only retrieve resources they have created.
            -->
                <allow>
                    <role>ROLE_AUTHOR</role>
                    <operation>create-member</operation>
                </allow>
                <allow>
                    <role>ROLE_AUTHOR</role>
                    <operation>create-media</operation>
                </allow>
                <allow>
                    <role>ROLE_AUTHOR</role>
                    <operation>list-collection</operation>
                </allow><!--
            Editors can list the collection, retrieve and update any member.
            -->
                <allow>
                    <role>ROLE_EDITOR</role>
                    <operation>list-collection</operation>
                </allow>
                <allow>
                    <role>ROLE_EDITOR</role>
                    <operation>retrieve-member</operation>
                </allow>
                <allow>
                    <role>ROLE_EDITOR</role>
                    <operation>update-member</operation>
                </allow>
                <allow>
                    <role>ROLE_EDITOR</role>
                    <operation>delete-member</operation>
                </allow><!-- Media editors -->
                <allow>
                    <role>ROLE_MEDIA_EDITOR</role>
                    <operation>list-collection</operation>
                </allow>
                <allow>
                    <role>ROLE_MEDIA_EDITOR</role>
                    <operation>retrieve-member</operation>
                </allow>
                <allow>
                    <role>ROLE_MEDIA_EDITOR</role>
                    <operation>retrieve-media</operation>
                </allow>
                <allow>
                    <role>ROLE_MEDIA_EDITOR</role>
                    <operation>update-media</operation>
                </allow>
                <allow>
                    <role>ROLE_MEDIA_EDITOR</role>
                    <operation>delete-media</operation>
                </allow><!--
            Readers can list the collection and retrieve any member.
            -->
                <allow>
                    <role>ROLE_READER</role>
                    <operation>list-collection</operation>
                </allow>
                <allow>
                    <role>ROLE_READER</role>
                    <operation>retrieve-member</operation>
                </allow>
                <allow>
                    <role>ROLE_READER</role>
                    <operation>retrieve-media</operation>
                </allow><!--
            Data authors can only create media resources with a specific media
            type.
            -->
                <allow>
                    <role>ROLE_DATA_AUTHOR</role>
                    <operation>create-media</operation>
                    <media-range>application/vnd.ms-excel</media-range>
                </allow>
            </rules>
        </acl>
    </atom:content>
</atom:entry>
}}}

Retrieve member then retrieve member ACL...

{{{
GET /atombeat/atombeat/content/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom HTTP/1.1
Authorization: Basic YXVkcmV5OnRlc3Q=
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:10 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom</atom:id>
    <atom:published>2010-03-25T13:34:11.064Z</atom:published>
    <atom:updated>2010-03-25T13:34:11.064Z</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom"/>
    <atom:link rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom"/>
    <atom:title>Test Entry</atom:title>
    <atom:summary>this is a test</atom:summary>
    <ar:comment xmlns:ar="http://purl.org/atompub/revision/1.0">
        <atom:author>
            <atom:name>audrey</atom:name>
        </atom:author>
        <atom:updated>2010-03-25T13:34:11.064Z</atom:updated>
        <atom:summary>initial revision</atom:summary>
    </ar:comment>
    <atom:link rel="history" href="http://localhost:8081/atombeat/atombeat/history/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom"/>
    <atom:link rel="edit-acl" href="http://localhost:8081/atombeat/atombeat/acl/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom" type="application/atom+xml"/>
</atom:entry>



GET /atombeat/atombeat/acl/0.9255307573775159/322fedb1-d46c-4d7b-8982-732d967e8360.atom HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081

HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:11 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:content type="application/vnd.atombeat+xml">
        <acl>
            <rules><!-- 
    The user who created the resource has full rights.
    -->
                <allow>
                    <user>audrey</user>
                    <operation>retrieve-member</operation>
                </allow>
                <allow>
                    <user>audrey</user>
                    <operation>update-member</operation>
                </allow>
                <allow>
                    <user>audrey</user>
                    <operation>delete-member</operation>
                </allow>
                <allow>
                    <user>audrey</user>
                    <operation>retrieve-media</operation>
                </allow>
                <allow>
                    <user>audrey</user>
                    <operation>update-media</operation>
                </allow>
                <allow>
                    <user>audrey</user>
                    <operation>delete-media</operation>
                </allow>
                <allow>
                    <user>audrey</user>
                    <operation>update-acl</operation>
                </allow>
            </rules>
        </acl>
    </atom:content>
</atom:entry>
}}}

Update global ACL...

{{{
PUT /atombeat/atombeat/acl/ HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 159
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:content type="application/vnd.atombeat+xml"><acl xmlns=""><rules/></acl></atom:content></atom:entry>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:14 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:content type="application/vnd.atombeat+xml">
        <acl>
            <rules/>
        </acl>
    </atom:content>
</atom:entry>
}}}

Update collection ACL...

{{{
PUT /atombeat/atombeat/acl/0.3345439750305319 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 159
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:content type="application/vnd.atombeat+xml"><acl xmlns=""><rules/></acl></atom:content></atom:entry>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:14 GMT

c1
<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:content type="application/vnd.atombeat+xml">
        <acl>
            <rules/>
        </acl>
    </atom:content>
</atom:entry>
}}}

Update resource ACL...

{{{
PUT /atombeat/atombeat/acl/0.043636994046552746/9875ca44-5402-44dd-a71f-53462e0d35fe.atom HTTP/1.1
Authorization: Basic YXVkcmV5OnRlc3Q=
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 159
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:content type="application/vnd.atombeat+xml"><acl xmlns=""><rules/></acl></atom:content></atom:entry>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Thu, 25 Mar 2010 13:34:16 GMT


<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:content type="application/vnd.atombeat+xml">
        <acl>
            <rules/>
        </acl>
    </atom:content>
</atom:entry>
}}}