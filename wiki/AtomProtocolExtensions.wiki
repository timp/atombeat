#summary extensions to the Atom Protocol

= Introduction =

This page has informal documentation on extensions to the [http://www.atomenabled.org/developers/protocol/atom-protocol-spec.php Atom Publishing Protocol standard] that we've found useful to implement while developing applications against AtomBeat. Some of these extensions may be contentious from the point of view of REST, HTTP 1.1, or the Atom Protocol standard, and we would appreciate input and discussion - please feel free to add comments on this page.

The documentation here is drawn from logs generated by running the AtomBeat protocol test cases. Links to the relevant test cases are provided in each section below - they are the definitive source of information on AtomBeat's protocol behaviour.

= Managing Collections =

See also the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/TestExtendedAtomProtocol_Collections.java TestExtendedAtomProtocol_Collections.java test case].

== Creating a Collection (PUT) ==

Sending a PUT request with an Atom Feed document to an unused URI...

{{{
PUT /atombeat/atombeat/content/0.4671342426310734 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>
}}}
 
...will result in a 201 response, and will create a new Atom collection at the request URI...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.4671342426310734
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:33:35 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.4671342426310734</atom:id>
    <atom:updated>2010-06-23T12:33:35.051+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.4671342426310734" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.4671342426310734" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.4671342426310734" type="application/atom+xml"/>
</atom:feed>
}}}

== Creating a Collection (POST) ==

Sending a POST request with an Atom Feed document to an unused URI...

{{{
POST /atombeat/atombeat/content/0.902833368184496 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>
}}}
 
...will result in a 201 response, and will create a new Atom collection at the request URI...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.902833368184496
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:36:59 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.902833368184496</atom:id>
    <atom:updated>2010-06-23T12:36:59.445+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.902833368184496" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.902833368184496" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.902833368184496" type="application/atom+xml"/>
</atom:feed>
}}}

Note that we prefer to use the PUT method to create a collection, rather than POST, because this is intuitively closer to the semantics of PUT as defined in HTTP 1.1. However, eXist's own Atom Protocol implementation supports this use of POST, and so we have retained it for compatibility.

== Updating Collection Metadata ==

Sending a PUT request with an Atom Feed document to a collection URI...

{{{
PUT /atombeat/atombeat/content/0.36679406352985167 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 114
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection - Updated</atom:title></atom:feed>
}}}

...will result in a 200 response, and will update the metadata in the collection's feed document...

{{{
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:38:18 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.36679406352985167</atom:id>
    <atom:updated>2010-06-23T12:38:18.943+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.36679406352985167" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.36679406352985167" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection - Updated</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.36679406352985167" type="application/atom+xml"/>
</atom:feed>
}}}

Note that any `atom:entry` elements in the request body will be ignored. This behaviour arguably bends the semantics of PUT, because the collection as a whole is not being updated, only the metadata in the feed document. 

== Collection URIs With Multiple Path Segments ==

Sending a PUT request with an Atom Feed document to an unused URI with multiple path segments...

{{{
PUT /atombeat/atombeat/content/0.48000088284052345/0.40239864913487866 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>
}}}

...will create an Atom collection at the request URI...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:45:31 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866</atom:id>
    <atom:updated>2010-06-23T12:45:31.897+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.48000088284052345/0.40239864913487866" type="application/atom+xml"/>
</atom:feed>
}}}

Note that this request *will not* create an Atom collection at the "parent" location, i.e., `http://localhost:8081/atombeat/atombeat/content/0.48000088284052345`.

If an Atom collection was then created at this parent location, or if an Atom collection already existed at the parent location, then the parent collection *would not* include members of the nested collection in its feed. I.e., there is no relationship between the two collections, AtomBeat treats them as separate collections at separate locations, and the fact that there is a relationship between their URIs is incidental - unless they are explicitly configured as recursive collections, see below.

== Recursive Collections ==

If two collections are created, where the location of one collection is nested within the location of the other, then the parent collection can be configured as a *recursive* collection, by using the `atombeat:recursive` extension attribute on the Atom Feed document element. The parent collection will then include all members all descendent collections in its feed document.

E.g., create the parent collection...

{{{
PUT /atombeat/atombeat/content/0.7717789412246353 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 190
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom" xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:recursive="true"><atom:title>Test Collection (Recursive)</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom" xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:recursive="true">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353</atom:id>
    <atom:updated>2010-06-23T12:55:16.848+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection (Recursive)</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353" type="application/atom+xml"/>
</atom:feed>
}}}

...then POST an entry to the parent collection...

{{{
POST /atombeat/atombeat/content/0.7717789412246353 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 144
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Entry</atom:title><atom:summary>this is a test</atom:summary></atom:entry>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom
Content-Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom
ETag: "5c2b99f6ead79b123beba18b08254f33"
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom</atom:id>
    <atom:published>2010-06-23T12:55:16.979+01:00</atom:published>
    <atom:updated>2010-06-23T12:55:16.979+01:00</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Entry</atom:title>
    <atom:summary>this is a test</atom:summary>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
</atom:entry>
}}}

...then create the child collection...

{{{
PUT /atombeat/atombeat/content/0.7717789412246353/0.9166719631007151 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 108
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Sub-Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151</atom:id>
    <atom:updated>2010-06-23T12:55:17.205+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Sub-Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/0.9166719631007151" type="application/atom+xml"/>
</atom:feed>
}}}

...then POST an entry to the sub-collection...

{{{
POST /atombeat/atombeat/content/0.7717789412246353/0.9166719631007151 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 144
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Entry</atom:title><atom:summary>this is a test</atom:summary></atom:entry>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom
Content-Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom
ETag: "d890a21ed17be17bde8fe37e60d238a9"
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom</atom:id>
    <atom:published>2010-06-23T12:55:17.361+01:00</atom:published>
    <atom:updated>2010-06-23T12:55:17.361+01:00</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Entry</atom:title>
    <atom:summary>this is a test</atom:summary>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
</atom:entry>
}}}

...then list the parent collection...

{{{
GET /atombeat/atombeat/content/0.7717789412246353 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:17 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom" xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:recursive="true">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353</atom:id>
    <atom:updated>2010-06-23T12:55:16.979+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection (Recursive)</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353" type="application/atom+xml"/>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom</atom:id>
        <atom:published>2010-06-23T12:55:17.361+01:00</atom:published>
        <atom:updated>2010-06-23T12:55:17.361+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:title>Test Entry</atom:title>
        <atom:summary>this is a test</atom:summary>
        <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom</atom:id>
        <atom:published>2010-06-23T12:55:16.979+01:00</atom:published>
        <atom:updated>2010-06-23T12:55:16.979+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:title>Test Entry</atom:title>
        <atom:summary>this is a test</atom:summary>
        <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
</atom:feed>
}}}
