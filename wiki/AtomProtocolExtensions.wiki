#summary extensions to the Atom Protocol

<wiki:toc/>

= Introduction =

This page has informal documentation on extensions to the [http://www.atomenabled.org/developers/protocol/atom-protocol-spec.php Atom Publishing Protocol standard] that we've found useful to implement while developing applications against AtomBeat. Some of these extensions may be contentious from the point of view of REST, HTTP 1.1, or the Atom Protocol standard, and we would appreciate input and discussion - please feel free to add comments on this page.

The documentation here is drawn from logs generated by running the AtomBeat protocol test cases. Links to the relevant test cases are provided in each section below - they are the definitive source of information on AtomBeat's protocol behaviour.

= Managing Collections =

See also the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/TestExtendedAtomProtocol_Collections.java TestExtendedAtomProtocol_Collections.java test case].

== Creating a Collection (PUT) ==

Sending a PUT request with an Atom Feed document to an unused URI...

{{{
PUT /atombeat/atombeat/content/0.4671342426310734 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>
}}}
 
...will result in a 201 response, and will create a new Atom collection at the request URI...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.4671342426310734
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:33:35 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.4671342426310734</atom:id>
    <atom:updated>2010-06-23T12:33:35.051+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.4671342426310734" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.4671342426310734" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.4671342426310734" type="application/atom+xml"/>
</atom:feed>
}}}

== Creating a Collection (POST) ==

Sending a POST request with an Atom Feed document to an unused URI...

{{{
POST /atombeat/atombeat/content/0.902833368184496 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>
}}}
 
...will result in a 201 response, and will create a new Atom collection at the request URI...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.902833368184496
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:36:59 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.902833368184496</atom:id>
    <atom:updated>2010-06-23T12:36:59.445+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.902833368184496" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.902833368184496" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.902833368184496" type="application/atom+xml"/>
</atom:feed>
}}}

Note that we prefer to use the PUT method to create a collection, rather than POST, because this is intuitively closer to the semantics of PUT as defined in HTTP 1.1. However, eXist's own Atom Protocol implementation supports this use of POST, and so we have retained it for compatibility.

== Updating Collection Metadata ==

Sending a PUT request with an Atom Feed document to a collection URI...

{{{
PUT /atombeat/atombeat/content/0.36679406352985167 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 114
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection - Updated</atom:title></atom:feed>
}}}

...will result in a 200 response, and will update the metadata in the collection's feed document...

{{{
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:38:18 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.36679406352985167</atom:id>
    <atom:updated>2010-06-23T12:38:18.943+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.36679406352985167" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.36679406352985167" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection - Updated</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.36679406352985167" type="application/atom+xml"/>
</atom:feed>
}}}

Note that any `atom:entry` elements in the request body will be ignored. This behaviour arguably bends the semantics of PUT, because the collection as a whole is not being updated, only the metadata in the feed document. 

== Collection URIs With Multiple Path Segments ==

Sending a PUT request with an Atom Feed document to an unused URI with multiple path segments...

{{{
PUT /atombeat/atombeat/content/0.48000088284052345/0.40239864913487866 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 104
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Collection</atom:title></atom:feed>
}}}

...will create an Atom collection at the request URI...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:45:31 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866</atom:id>
    <atom:updated>2010-06-23T12:45:31.897+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.48000088284052345/0.40239864913487866" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.48000088284052345/0.40239864913487866" type="application/atom+xml"/>
</atom:feed>
}}}

Note that this request *will not* create an Atom collection at the "parent" location, i.e., `http://localhost:8081/atombeat/atombeat/content/0.48000088284052345`.

If an Atom collection was then created at this parent location, or if an Atom collection already existed at the parent location, then the parent collection *would not* include members of the nested collection in its feed. I.e., there is no relationship between the two collections, AtomBeat treats them as separate collections at separate locations, and the fact that there is a relationship between their URIs is incidental - unless they are explicitly configured as recursive collections, see below.

== Recursive Collections ==

If two collections are created, where the location of one collection is nested within the location of the other, then the parent collection can be configured as a *recursive* collection, by using the `atombeat:recursive` extension attribute on the Atom Feed document element. The parent collection will then include all members of all descendent collections in its feed document.

E.g., create the parent collection...

{{{
PUT /atombeat/atombeat/content/0.7717789412246353 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 190
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom" xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:recursive="true"><atom:title>Test Collection (Recursive)</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom" xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:recursive="true">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353</atom:id>
    <atom:updated>2010-06-23T12:55:16.848+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection (Recursive)</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353" type="application/atom+xml"/>
</atom:feed>
}}}

...then POST an entry to the parent collection...

{{{
POST /atombeat/atombeat/content/0.7717789412246353 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 144
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Entry</atom:title><atom:summary>this is a test</atom:summary></atom:entry>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom
Content-Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom
ETag: "5c2b99f6ead79b123beba18b08254f33"
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom</atom:id>
    <atom:published>2010-06-23T12:55:16.979+01:00</atom:published>
    <atom:updated>2010-06-23T12:55:16.979+01:00</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Entry</atom:title>
    <atom:summary>this is a test</atom:summary>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
</atom:entry>
}}}

...then create the child collection...

{{{
PUT /atombeat/atombeat/content/0.7717789412246353/0.9166719631007151 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 108
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Sub-Collection</atom:title></atom:feed>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151</atom:id>
    <atom:updated>2010-06-23T12:55:17.205+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Sub-Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/0.9166719631007151" type="application/atom+xml"/>
</atom:feed>
}}}

...then POST an entry to the sub-collection...

{{{
POST /atombeat/atombeat/content/0.7717789412246353/0.9166719631007151 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 144
Content-Type: application/atom+xml; charset=utf-8

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom"><atom:title>Test Entry</atom:title><atom:summary>this is a test</atom:summary></atom:entry>


HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom
Content-Location: http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom
ETag: "d890a21ed17be17bde8fe37e60d238a9"
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:16 GMT

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom</atom:id>
    <atom:published>2010-06-23T12:55:17.361+01:00</atom:published>
    <atom:updated>2010-06-23T12:55:17.361+01:00</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Entry</atom:title>
    <atom:summary>this is a test</atom:summary>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
</atom:entry>
}}}

...then list the parent collection...

{{{
GET /atombeat/atombeat/content/0.7717789412246353 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 11:55:17 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom" xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:recursive="true">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353</atom:id>
    <atom:updated>2010-06-23T12:55:16.979+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection (Recursive)</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353" type="application/atom+xml"/>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom</atom:id>
        <atom:published>2010-06-23T12:55:17.361+01:00</atom:published>
        <atom:updated>2010-06-23T12:55:17.361+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:title>Test Entry</atom:title>
        <atom:summary>this is a test</atom:summary>
        <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/0.9166719631007151/546770b7-36e6-470c-988f-0382d47ffc95.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom</atom:id>
        <atom:published>2010-06-23T12:55:16.979+01:00</atom:published>
        <atom:updated>2010-06-23T12:55:16.979+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:title>Test Entry</atom:title>
        <atom:summary>this is a test</atom:summary>
        <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.7717789412246353/aea47450-9286-4320-b814-2f59b91eb620.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
</atom:feed>
}}}

== Excluding Entry Content in Feeds ==

Typically, we use content-based extensions of Atom in our applications. I.e., all the application-specific data is stored inside the `atom:content` element in an Atom entry. There is then a clear distinction between the metadata (all other children of `atom:entry`) and the data (child of `atom:content`). However, when some entries can contain a reasonable amount of data, retrieving a feed of the collection with a complete representation of every entry can be inefficient. This is the default behaviour, but you can turn it off by setting the `atombeat:exclude-entry-content` attribute on the collection feed document to `true`. If this attribute is set, any child element of the `atom:content` element will be removed when generating a collection feed. You can, of course, obtain a complete representation of a member by sending a GET request to the member URI.

= Posting Media From Forms =

While the standard Atom Protocol operation for creating media resources, by sending the media content as the body of a POST request, is simple and elegant, and very useful when working in desktop or server-side programming context, it is, unfortunately, impossible to use from a browser context (i.e., from an HTML form), or from XForms. This means that, if you want to use an Atom Protocol service to store file uploads, you have to write some sort of intermediate service that can receive form posts, and adapt them to standard Atom requests, which can be inconvenient.

To work around this, the AtomBeat Atom Protocol engine has custom behaviour for handling multipart/form-data requests that follow a particular convention, so you can upload files to an AtomBeat collection directly from an HTML form or XForm.

Note that some !JavaScript client libraries (e.g., [http://google-web-toolkit.googlecode.com/svn/javadoc/2.1/com/google/gwt/user/client/ui/FormPanel.html#FormPanel%28%29 GWT]) report inconsistent browser behaviour when returning anything other than text/html from a form post request, if you want to handle the response in a hidden iframe. If this is an issue for you, let us know, and we can look into returning text/html by default, but enabling some primitive content negiotation for others who want application/atom+xml (this feature was available in previous versions of AtomBeat but has been removed due to issues with the previous implementation). 

See also the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/TestExtendedAtomProtocol_MultipartFormdata.java TestExtendedAtomProtocol_MultipartFormdata.java test case].

Sending a POST request to a collection URI with multipart/form-data content, with a file part named "media"...

{{{
POST /atombeat/atombeat/content/test HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 7303
Content-Type: multipart/form-data; boundary=nFFsBIs7mx6CJa9KWAvJp6U-BIKBdXRs8

--nFFsBIs7mx6CJa9KWAvJp6U-BIKBdXRs8
Content-Disposition: form-data; name="media"; filename="spreadsheet1.xls"
Content-Type: application/vnd.ms-excel; charset=ISO-8859-1
Content-Transfer-Encoding: binary

[... binary data ...]
--nFFsBIs7mx6CJa9KWAvJp6U-BIKBdXRs8
Content-Disposition: form-data; name="summary"
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 8bit

this is a great spreadsheet
--nFFsBIs7mx6CJa9KWAvJp6U-BIKBdXRs8
Content-Disposition: form-data; name="category"
Content-Type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 8bit

scheme="foo"; term="bar"; label="baz"
--nFFsBIs7mx6CJa9KWAvJp6U-BIKBdXRs8--
}}}

...will result in a 201 response, and create a new media resource, also using other form parts named "summary" and "category", if present, to populate the media-link entry...

{{{
HTTP/1.1 201 Created
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Location: http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.atom
Content-Location: http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.atom
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 12:18:02 GMT

<atom:entry xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.atom</atom:id>
    <atom:published>2010-06-23T13:18:02.15+01:00</atom:published>
    <atom:updated>2010-06-23T13:18:02.15+01:00</atom:updated>
    <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.atom"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.atom"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit-media" type="application/vnd.ms-excel" href="http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.media" length="6656"/>
    <atom:content src="http://localhost:8081/atombeat/atombeat/content/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.media" type="application/vnd.ms-excel"/>
    <atom:title type="text">spreadsheet1.xls</atom:title>
    <atom:summary type="text">this is a great spreadsheet</atom:summary>
    <atom:category scheme="foo" term="bar" label="baz"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/media-security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/test/948d2173-41a5-40a8-b0f0-a4b31bf102e3.media" type="application/atom+xml" atombeat:allow="GET, PUT"/>
</atom:entry>
}}}

An HTML form to create an appropriate multipart/form-data request might look something like...

{{{
<form 
  action="/atombeat/atombeat/content/test"
  enctype="multipart/form-data"  
  method="post">
  <p>Summary:<br/><input type="text" name="summary" size="30"/></p>
  <p>Select file:<br/><input type="file" name="media" size="40"></p>
  <input type="hidden" name="category" value="scheme=&quot;foo&quot;; term=&quot;bar&quot;; label=&quot;baz&quot;"/>
  <p><input type="submit" value="Submit"/></p>
</form>
}}}

An XForm to send an appropriate request might look like (e.g., using Orbeon)...

{{{
<html xmlns:xforms="http://www.w3.org/2002/xforms"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:xxforms="http://orbeon.org/oxf/xml/xforms"
    xmlns:xs="http://www.w3.org/2001/XMLSchema"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns:ev="http://www.w3.org/2001/xml-events"
    xmlns:atom="http://www.w3.org/2005/Atom"
    xmlns:xi="http://www.w3.org/2001/XInclude"
    xmlns:atombeat="http://purl.org/atombeat/xmlns">
    
    <head>
    
        <title>Spike Upload</title>
        
        <xforms:model>

        	<xforms:instance id="ins-upload">
        		<upload xmlns="">
        			<summary/>
        			<media
        				filename=""
        				mediatype=""
        				size=""
        				xsi:type="xs:anyURI"/>
        			<category>term="foo"; scheme="bar"; label="baz"</category>
        		</upload>
        	</xforms:instance>
        	
        	<xforms:submission
        		id="sub-form-data-post"
        		method="form-data-post"
        		resource="/atombeat/content/test"
        		replace="instance"
        		instance="ins-post-response"
        		ref="instance('ins-upload')">
        	</xforms:submission>
        	
        	<xforms:instance id="ins-post-response">
        		<foo xmlns=""/>
        	</xforms:instance>
 
        </xforms:model>

    </head>
    <body>

    	<h1>Spike Upload</h1>
    	
    	<xforms:group ref="instance('ins-upload')">

    		<p>
    			
    			<!-- Upload field -->
    			<xforms:upload ref="media" xxforms:size="60">
    				<xforms:label>Upload file: </xforms:label>
    				<xforms:filename ref="@filename"/>
    				<xforms:mediatype ref="@mediatype"/>
    				<xxforms:size ref="@size"/>
    			</xforms:upload>
    			
    		</p>
    		
    		<p>
    			<xforms:textarea ref="summary">
    				<xforms:label>Summary: </xforms:label>
    			</xforms:textarea>
    		</p>

    	</xforms:group>
    	
    	<p>
    		<xforms:submit submission="sub-form-data-post">
    			<xforms:label>Submit (form-data-post)</xforms:label>
    		</xforms:submit>
    	</p>
    	    	
    </body>
</html>
}}}

= Multi-Create =

We've coming across situations where it is useful to create some new members one by one in a collection, then copy them all across in one go to another collection. This can of course be done by POSTing each entry one by one to the new collection, but it is more convenient to send the entries in a single request. AtomBeat supports a "multi-create" operation, where POSTing a feed document containing one or more entries to a collection URI will be processed as if each Atom entry had been individually POSTed to the collection URI.

See also the [http://code.google.com/p/atombeat/source/browse/trunk/atombeat/src/test/java/org/atombeat/TestExtendedAtomProtocol_MultiCreate.java TestExtendedAtomProtocol_MultiCreate.java test case].
 
== Create One or More New Collection Members ==

A POST request with an Atom Feed document containing one or more Atom entries to a collection URI...

{{{
POST /atombeat/atombeat/content/0.9214369778190652 HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 294
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:entry>
        <atom:title>Test Member</atom:title>
        <atom:summary>This is a summary.</atom:summary>
    </atom:entry>
    <atom:entry>
        <atom:title>Another Test Member</atom:title>
        <atom:summary>This is another summary.</atom:summary>
    </atom:entry>
</atom:feed>
}}}

...will be processed as if each Atom entry had been individually POSTed to the collection URI, thus creating a new member for each Atom entry in the submitted feed document, and will result in a 200 response, where the response is an Atom feed document containing the newly created members...

{{{
HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 14:52:14 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.9214369778190652/9bd60358-e0b8-4b8c-9d8c-d337f40b3347.atom</atom:id>
        <atom:published>2010-06-23T15:52:14.52+01:00</atom:published>
        <atom:updated>2010-06-23T15:52:14.52+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.9214369778190652/9bd60358-e0b8-4b8c-9d8c-d337f40b3347.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.9214369778190652/9bd60358-e0b8-4b8c-9d8c-d337f40b3347.atom"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:title>Test Member</atom:title>
        <atom:summary>This is a summary.</atom:summary>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.9214369778190652/9bd60358-e0b8-4b8c-9d8c-d337f40b3347.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/0.9214369778190652/c0e0c57e-3cb4-4098-b792-80929822bbd7.atom</atom:id>
        <atom:published>2010-06-23T15:52:14.52+01:00</atom:published>
        <atom:updated>2010-06-23T15:52:14.52+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.9214369778190652/c0e0c57e-3cb4-4098-b792-80929822bbd7.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/0.9214369778190652/c0e0c57e-3cb4-4098-b792-80929822bbd7.atom"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:title>Another Test Member</atom:title>
        <atom:summary>This is another summary.</atom:summary>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/0.9214369778190652/c0e0c57e-3cb4-4098-b792-80929822bbd7.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
</atom:feed>
}}}

== Copying Media Resources ==

If an Atom entry in a multi-create request (as above) is a media-link entry, and the associated media resource is also hosted by the AtomBeat instance, then the effect will be to copy *both* the media resource and the media-link entry to the new collection. I.e., you can use the multi-create request to copy a set of media resources from one collection to another.

E.g., retrieve a feed from the collection at `/foo`...

{{{
GET /atombeat/atombeat/content/foo HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 14:59:13 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/foo</atom:id>
    <atom:updated>2010-06-23T15:59:13.206+01:00</atom:updated>
    <atom:link rel="self" href="http://localhost:8081/atombeat/atombeat/content/foo" type="application/atom+xml"/>
    <atom:link rel="edit" href="http://localhost:8081/atombeat/atombeat/content/foo" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/foo" type="application/atom+xml"/>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom</atom:id>
        <atom:published>2010-06-23T15:59:13.206+01:00</atom:published>
        <atom:updated>2010-06-23T15:59:13.206+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit-media" type="application/vnd.ms-excel" href="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.media" length="6656"/>
        <atom:content src="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.media" type="application/vnd.ms-excel"/>
        <atom:title type="text">download-f9434b75-567b-42fc-a8e4-27bf4f669ad0.media</atom:title>
        <atom:summary type="text">media resource</atom:summary>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/media-security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.media" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom</atom:id>
        <atom:published>2010-06-23T15:59:12.947+01:00</atom:published>
        <atom:updated>2010-06-23T15:59:12.947+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit-media" type="text/plain" href="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.media" length="15"/>
        <atom:content src="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.media" type="text/plain"/>
        <atom:title type="text">download-d0b86219-50f7-46dd-9779-3bedb74e2cba.media</atom:title>
        <atom:summary type="text">media resource</atom:summary>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/media-security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.media" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
</atom:feed>
}}}

...then copy the members of `/foo` to `/bar`...

{{{
POST /atombeat/atombeat/content/bar HTTP/1.1
Authorization: Basic YWRhbTp0ZXN0
User-Agent: Jakarta Commons-HttpClient/3.1
Host: localhost:8081
Content-Length: 4841
Content-Type: application/atom+xml; charset=utf-8

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:id>http://localhost:8081/atombeat/atombeat/content/foo</atom:id>
    <atom:updated>2010-06-23T15:59:13.206+01:00</atom:updated>
    <atom:link href="http://localhost:8081/atombeat/atombeat/content/foo" rel="self" type="application/atom+xml"/>
    <atom:link href="http://localhost:8081/atombeat/atombeat/content/foo" rel="edit" type="application/atom+xml"/>
    <atom:author>
        <atom:name>adam</atom:name>
    </atom:author>
    <atom:title>Test Collection</atom:title>
    <atom:link href="http://localhost:8081/atombeat/atombeat/security/foo" rel="http://purl.org/atombeat/rel/security-descriptor" type="application/atom+xml"/>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom</atom:id>
        <atom:published>2010-06-23T15:59:13.206+01:00</atom:published>
        <atom:updated>2010-06-23T15:59:13.206+01:00</atom:updated>
        <atom:link href="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom" rel="self" type="application/atom+xml"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" href="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom" rel="edit" type="application/atom+xml" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" href="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.media" length="6656" rel="edit-media" type="application/vnd.ms-excel" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
        <atom:content src="http://localhost:8081/atombeat/atombeat/content/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.media" type="application/vnd.ms-excel"/>
        <atom:title type="text">download-f9434b75-567b-42fc-a8e4-27bf4f669ad0.media</atom:title>
        <atom:summary type="text">media resource</atom:summary>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:link atombeat:allow="GET, PUT" href="http://localhost:8081/atombeat/atombeat/security/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.atom" rel="http://purl.org/atombeat/rel/security-descriptor" type="application/atom+xml" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
        <atom:link atombeat:allow="GET, PUT" href="http://localhost:8081/atombeat/atombeat/security/foo/f9434b75-567b-42fc-a8e4-27bf4f669ad0.media" rel="http://purl.org/atombeat/rel/media-security-descriptor" type="application/atom+xml" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
    </atom:entry>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom</atom:id>
        <atom:published>2010-06-23T15:59:12.947+01:00</atom:published>
        <atom:updated>2010-06-23T15:59:12.947+01:00</atom:updated>
        <atom:link href="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom" rel="self" type="application/atom+xml"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" href="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom" rel="edit" type="application/atom+xml" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
        <atom:link atombeat:allow="GET, PUT, DELETE" href="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.media" length="15" rel="edit-media" type="text/plain" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
        <atom:content src="http://localhost:8081/atombeat/atombeat/content/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.media" type="text/plain"/>
        <atom:title type="text">download-d0b86219-50f7-46dd-9779-3bedb74e2cba.media</atom:title>
        <atom:summary type="text">media resource</atom:summary>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:link atombeat:allow="GET, PUT" href="http://localhost:8081/atombeat/atombeat/security/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.atom" rel="http://purl.org/atombeat/rel/security-descriptor" type="application/atom+xml" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
        <atom:link atombeat:allow="GET, PUT" href="http://localhost:8081/atombeat/atombeat/security/foo/d0b86219-50f7-46dd-9779-3bedb74e2cba.media" rel="http://purl.org/atombeat/rel/media-security-descriptor" type="application/atom+xml" xmlns:atombeat="http://purl.org/atombeat/xmlns"/>
    </atom:entry>
</atom:feed>


HTTP/1.1 200 OK
Server: Apache-Coyote/1.1
pragma: no-cache
Cache-Control: no-cache
Content-Type: application/atom+xml;charset=UTF-8
Transfer-Encoding: chunked
Date: Wed, 23 Jun 2010 14:59:13 GMT

<atom:feed xmlns:atom="http://www.w3.org/2005/Atom">
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/bar/16311072-839a-4181-8e1e-658a67249d2c.atom</atom:id>
        <atom:published>2010-06-23T15:59:14.04+01:00</atom:published>
        <atom:updated>2010-06-23T15:59:14.04+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/bar/16311072-839a-4181-8e1e-658a67249d2c.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/bar/16311072-839a-4181-8e1e-658a67249d2c.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit-media" type="application/vnd.ms-excel" href="http://localhost:8081/atombeat/atombeat/content/bar/16311072-839a-4181-8e1e-658a67249d2c.media" length="6656"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:content src="http://localhost:8081/atombeat/atombeat/content/bar/16311072-839a-4181-8e1e-658a67249d2c.media" type="application/vnd.ms-excel"/>
        <atom:title type="text">download-f9434b75-567b-42fc-a8e4-27bf4f669ad0.media</atom:title>
        <atom:summary type="text">media resource</atom:summary>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/bar/16311072-839a-4181-8e1e-658a67249d2c.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/media-security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/bar/16311072-839a-4181-8e1e-658a67249d2c.media" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
    <atom:entry>
        <atom:id>http://localhost:8081/atombeat/atombeat/content/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.atom</atom:id>
        <atom:published>2010-06-23T15:59:14.04+01:00</atom:published>
        <atom:updated>2010-06-23T15:59:14.04+01:00</atom:updated>
        <atom:link rel="self" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit" type="application/atom+xml" href="http://localhost:8081/atombeat/atombeat/content/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.atom"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" atombeat:allow="GET, PUT, DELETE" rel="edit-media" type="text/plain" href="http://localhost:8081/atombeat/atombeat/content/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.media" length="15"/>
        <atom:author>
            <atom:name>adam</atom:name>
        </atom:author>
        <atom:content src="http://localhost:8081/atombeat/atombeat/content/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.media" type="text/plain"/>
        <atom:title type="text">download-d0b86219-50f7-46dd-9779-3bedb74e2cba.media</atom:title>
        <atom:summary type="text">media resource</atom:summary>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.atom" type="application/atom+xml" atombeat:allow="GET, PUT"/>
        <atom:link xmlns:atombeat="http://purl.org/atombeat/xmlns" rel="http://purl.org/atombeat/rel/media-security-descriptor" href="http://localhost:8081/atombeat/atombeat/security/bar/ee41e4b9-94e9-4807-b9d6-4cdc8990ae0f.media" type="application/atom+xml" atombeat:allow="GET, PUT"/>
    </atom:entry>
</atom:feed>
}}}

Notice that the second entry is a media-link entry, and that the associated media resource has also been copied to the target collection.
